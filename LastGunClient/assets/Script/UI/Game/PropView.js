// Learn cc.Class:
//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html
//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html
// Learn Attribute:
//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html
//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html
// Learn life-cycle callbacks:
//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html
//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html
var level = [
    
[
    [-121,422,1,0],
    [188,173,1,0],
    [-192,-309,1,0],
    [196,-59,1,0],
    [0,300,2,0],
],

[
    [-201,401,1,0],
    [107,71,1,0],
    [-106,-159,1,0],
    [89,-97,1,0],
    [-195,192,3,0],
],

[
    [-200,0,1,0],
    [193,455,1,0],
    [-200,-300,1,0],
    [189,246,1,0],
    [-200,284,1,0],
    [0,304,2,0],
],


//50分后

[
    [-200,-75,1,0],
    [0,412,1,0],
    [200,33,1,0],
    [-200,-300,1,0],
    [200,289,1,0],
    [0,-135,3,0],
    [200,-203,1,0],
    [0,193,1,0],
    [-200,284,1,0],
    [0,26,2,0],
    [0,-333,1,0],
],

[
    [-100,0,1,0],
    [100,150,1,0],
    [200,300,1,0],
    [-100,-150,1,0],
    [100,0,1,0],
    [200,500,1,0],
    [-100,150,1,0],
    [0,0,2,0],
    [100,-150,1,0],
    [200,400,2,0],
],

[
    [-100,0,1,0],
    [50,150,1,0],
    [-100,-150,1,0],
    [50,450,1,0],
    [-100,150,1,0],
    [50,300,1,0],
],

[
    [-100,-50,1,0],
    [0,50,1,0],
    [-100,-150,1,0],
    [100,50,1,0],
    [-100,50,1,0],
    [0,-50,2,0],
    [100,-50,1,0],
    [100,-150,1,0],
    [0,-150,1,0],
    [-200,304,1,0],
    [-200,400,1,0],
    [200,315,1,0],
    [200,411,1,0],
],

[
    [50,300,1,0],
    [-50,0,1,0],
    [50,100,1,0],
    [-50,-371,3,50],
    [-50,100,1,0],
    [0,-50,2,0],
    [50,200,1,0],
    [-50,-251,3,50],
    [50,-371,3,-50],
    [50,0,1,0],
    [50,-251,3,-50],
    [0,-150,3,0],
    [-50,200,1,0],
    [-50,300,1,0],
],

[
    [0,183,1,0],
    [-200,-233,1,0],
    [200,100,1,0],
    [-200,-400,3,50],
    [200,200,1,0],
    [200,300,1,0],
    [-50,-300,3,50],
    [-200,-99,1,0],
    [100,-200,3,50],
    [200,-62,3,0],
    [-150,115,1,0],
    [-150,254,1,0],
],

[
    [50,100,1,0],
    [-50,-233,1,0],
    [-50,400,1,0],
    [-50,0,2,0],
    [-50,-99,1,0],
    [50,200,1,0],
    [-50,300,1,0],
],

[
    [50,300,1,0],
    [-50,-200,1,0],
    [50,400,1,0],
    [-50,-100,1,0],
    [50,200,1,0],
    [-50,0,1,0],
    [-200,345,1,0],
    [-200,145,1,0],
],

[
    [50,-100,1,0],
    [-50,-200,1,0],
    [50,-200,1,0],
    [-50,-100,1,0],
    [0,-300,3,0],
    [50,0,1,0],
    [-50,0,1,0],
    [100,100,1,0],
    [-100,100,1,0],
    [100,200,1,0],
    [-100,200,1,0],
    [0,200,1,0],
    [-100,442,1,0],
    [0,442,1,0],
    [100,442,1,0],
],

//500分后


[
    [50,-100,1,0],
    [-50,-200,1,0],
    [50,-200,1,0],
    [0,100,2,0],
    [-50,-100,1,0],
    [50,0,1,0],
    [-50,0,1,0],
    [100,100,1,0],
    [-100,100,1,0],
    [100,200,1,0],
    [-100,200,1,0],
    [0,200,1,0],
    [-100,442,1,0],
    [0,442,1,0],
    [100,442,1,0],
    [-200,-103,4,0],
],

[
    [0,183,1,0],
    [-200,-233,1,0],
    [200,100,1,0],
    [-200,-300,4,0],
    [-200,-400,3,50],
    [200,200,1,0],
    [-50,-40,2,0],
    [200,300,1,0],
    [-50,-300,3,50],
    [-200,-99,1,0],
    [100,-200,3,50],
    [200,-62,3,0],
    [-150,115,1,0],
    [-150,254,1,0],
],

[
    [80,24,4,0],
    [-171,-424,3,0],
    [-170,-318,1,0],
    [-70,182,2,0],
    [-70,-318,1,0],
    [-70,82,1,0],
    [-70,-18,1,0],
    [-170,-118,1,0],
    [-170,-218,1,0],
    [-70,-118,1,0],
    [-70,-218,1,0],
    [180,-183,3,0],
    [180,382,1,0],
    [180,82,1,0],
    [180,-68,1,0],
    [180,232,1,0],
    [-170,168,1,0],
    [-170,468,1,0],
    [-170,318,1,0]
],

[
    [106,-259,4,0],[-100,150,1,0],[0,-50,1,0],[-100,-50,1,0],[100,50,1,0],[0,50,1,0],[-100,50,1,0],[100,150,1,0],[0,150,1,0],[100,-50,1,0],[0,-150,2,0],[0,250,1,0],[0,450,1,0],[0,350,1,0]
],

[
    [0,0,4,0],
    [200,200,1,0],
    [-150,-337,1,0],
    [-150,61,1,0],
    [0,-100,1,0],
    [200,-100,1,0],
    [200,50,1,0],
    [-200,400,1,0],
    [200,350,1,0],
    [-150,-187,1,0],
    [-150,-68,2,0],
    [0,200,1,0],
    [-100,300,1,0],
    [200,-250,1,0],
    [-150,-480,3,0]
],
]
var SpriteAnimation = require("../SpriteAnimation"); 
cc.Class({
    extends: cc.Component,

    properties: {
        objectPool: {
            default: [],
            type: [cc.Sprite],
        },
        object_prefab: {
            default: null,
            type: cc.Prefab,
        },
        objectAtlas: {
            default: null,
            type: cc.SpriteAtlas,
        },
        curIdx:{
            default:0,
            tpye:cc.Integer,
        }
    },

    // LIFE-CYCLE CALLBACKS:

    // onLoad () {},

    start() {
    },

    drowProp() {
        var random;
        if(this.curIdx>10 && this.curIdx < 100){
            random = Math.ceil(Math.random()*11)-1;
        }else if(this.curIdx > 100){
            random = Math.ceil(Math.random()*17)-1;
        }else{
            random = Math.ceil(Math.random()*3)-1;
        }
        var curMap = level[random];
        for (var i = 0; i < curMap.length; i = i + 1) {
            var temp;
            if (this.objectPool.length <= i) {
                temp = cc.instantiate(this.object_prefab);
                this.objectPool[i] = temp.getComponent(cc.Sprite);
            } else {
                temp = this.objectPool[i].node;
            }
            var box = temp.getComponent(cc.BoxCollider);
            var rig = temp.getComponent(cc.RigidBody);
            if(rig == null ){
                rig = temp.addComponent(cc.RigidBody);
                rig.type = cc.RigidBodyType.Static; 
            }
            rig.bullet = false;

            var spriteAnim = temp.getComponent(SpriteAnimation);
            if (curMap[i][2] == 1) {
                this.objectPool[i].spriteFrame = this.objectAtlas.getSpriteFrame("coin_0");
                temp.scale = 0.6;
                spriteAnim.playSprites("coin_",6,0,0,10,true,0.6);
                box.tag = 1;
            } else if (curMap[i][2] == 2) {
                this.objectPool[i].spriteFrame = this.objectAtlas.getSpriteFrame("bullet_0");
                spriteAnim.playSpriteByIdx("bullet_",0);
                temp.scale = 1.5;
                box.tag = 2;
            } else if (curMap[i][2] == 3) {
                this.objectPool[i].spriteFrame = this.objectAtlas.getSpriteFrame("speed_0");
                spriteAnim.playSprites("speed_",3,0,0,8,true,0.6);
                box.tag = 3;
            } else if (curMap[i][2] == 4) {
                this.objectPool[i].spriteFrame = this.objectAtlas.getSpriteFrame("brick");
                spriteAnim.playSpriteByName("brick","");
                rig.bullet = true;
                temp.scale = 1;
                box.tag = 4;
            }
            box.size.width = temp.width;
            box.size.height = temp.height;
            if(curMap[i][2] == 4 || curMap[i][2] == 2 || curMap[i][2] == 3){
                box.size.width = temp.width - 80;
                box.size.height = temp.height - 80;
            }
            temp.opacity = 255;
            temp.parent = this.node;
            temp.x = curMap[i][0];
            temp.y = curMap[i][1];
            temp.rotation = curMap[i][3];
            box.enabled = true;
        }
        for (var i = curMap.length; i < this.objectPool.length; i = i + 1) {
            this.objectPool[i].node.opacity = 0;
            var box = this.objectPool[i].node.getComponent(cc.BoxCollider);
            box.enabled = false;
        }
    },

    move(val) {
        this.node.y = this.node.y + val;
        if (this.node.y < -cc.winSize.height) {
            this.circle();
        }
    },

    circle() {
        this.curIdx = this.curIdx + 2;
        this.node.y = this.node.y + 2 * cc.winSize.height;
        this.drowProp();
    },

    // update (dt) {},
});
